<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå–¶æ¥­ã‚¢ãƒã‚¤ãƒ³ãƒˆè‡ªå‹•åŒ–BOT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }
        
        .search-form {
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 1.1em;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
            background-color: white;
        }
        
        .form-group select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 45px;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group select:hover {
            border-color: #764ba2;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .status-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            display: none;
        }
        
        .status-card.show {
            display: block;
        }
        
        .status-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-text {
            font-size: 1.1em;
            color: #333;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            display: none;
        }
        
        .results-table.show {
            display: table;
        }
        
        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .results-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .results-table tr:hover {
            background: #f8f9fa;
        }
        
        .company-info {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        .company-name {
            font-size: 1.3em;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
        }
        
        .info-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 3px;
        }
        
        .info-value {
            font-weight: 500;
            color: #333;
        }
        
        .keyman-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .keyman-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .keyman-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }
        
        .keyman-position {
            color: #666;
            font-size: 0.95em;
        }
        
        .sns-links {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .sns-link {
            color: #667eea;
            text-decoration: none;
            font-size: 0.9em;
            padding: 5px 15px;
            border: 1px solid #667eea;
            border-radius: 20px;
            transition: all 0.3s;
        }
        
        .sns-link:hover {
            background: #667eea;
            color: white;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .export-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .export-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .main-card {
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– AIå–¶æ¥­ã‚¢ãƒã‚¤ãƒ³ãƒˆè‡ªå‹•åŒ–BOT</h1>
            <p>ä¼æ¥­ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ãƒ»å½¹å“¡/è²¬ä»»è€…ç‰¹å®šã‚’è‡ªå‹•åŒ–</p>
        </div>
        
        <div class="main-card">
            <div class="search-form">
                <h2 style="margin-bottom: 20px; color: #333;">æ¤œç´¢æ¡ä»¶ã‚’å…¥åŠ›</h2>
                
                <form id="searchForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="industry">ğŸ¢ æ¥­ç•Œ *</label>
                            <select id="industry" name="industry" required>
                                <option value="">æ¥­ç•Œã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="beauty">ç¾å®¹ãƒ»åŒ–ç²§å“</option>
                                <option value="it_saas">ITãƒ»SaaS</option>
                                <option value="realestate">ä¸å‹•ç”£</option>
                                <option value="fintech">é‡‘èãƒ»ãƒ•ã‚£ãƒ³ãƒ†ãƒƒã‚¯</option>
                                <option value="healthcare">ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢ãƒ»åŒ»ç™‚</option>
                                <option value="retail">å°å£²ãƒ»Eã‚³ãƒãƒ¼ã‚¹</option>
                                <option value="manufacturing">è£½é€ æ¥­</option>
                                <option value="food">é£²é£Ÿãƒ»é£Ÿå“</option>
                                <option value="education">æ•™è‚²ãƒ»EdTech</option>
                                <option value="logistics">ç‰©æµ</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="revenue">ğŸ’° å£²ä¸Šè¦æ¨¡ *</label>
                            <select id="revenue" name="revenue" required>
                                <option value="">å£²ä¸Šè¦æ¨¡ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="under10">10å„„å††æœªæº€</option>
                                <option value="10to30">10å„„å††ä»¥ä¸Š30å„„å††æœªæº€</option>
                                <option value="30to50">30å„„å††ä»¥ä¸Š50å„„å††æœªæº€</option>
                                <option value="50to100">50å„„å††ä»¥ä¸Š100å„„å††æœªæº€</option>
                                <option value="over100">100å„„å††ä»¥ä¸Š</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="keywords">ğŸ” è¿½åŠ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆä»»æ„ï¼‰</label>
                        <input 
                            type="text" 
                            id="keywords" 
                            name="keywords" 
                            placeholder="ä¾‹: D2Cã€ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã€æ±äº¬ã€ã‚·ãƒªãƒ¼ã‚ºA"
                        >
                        <small style="color: #666; font-size: 0.9em; margin-top: 5px; display: block;">
                            ã‚ˆã‚Šè©³ç´°ãªæ¡ä»¶ã‚’æŒ‡å®šã—ãŸã„å ´åˆã«å…¥åŠ›ã—ã¦ãã ã•ã„
                        </small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="numCompanies">ğŸ“Š ä¼æ¥­æ•°</label>
                            <input 
                                type="number" 
                                id="numCompanies" 
                                name="numCompanies" 
                                value="5" 
                                min="1" 
                                max="100"
                            >
                            <small style="color: #666; font-size: 0.9em; margin-top: 5px; display: block;">
                                æœ€å¤§100ç¤¾ã¾ã§å–å¾—å¯èƒ½ã§ã™
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="maxKeymen">ğŸ‘¥ å½¹å“¡ãƒ»è²¬ä»»è€…æ•°/ä¼æ¥­</label>
                            <input 
                                type="number" 
                                id="maxKeymen" 
                                name="maxKeymen" 
                                value="5" 
                                min="1" 
                                max="10"
                            >
                        </div>
                    </div>
                    
                    <button type="submit" class="btn" id="submitBtn">
                        ğŸ” æ¤œç´¢ã‚’é–‹å§‹
                    </button>
                </form>
            </div>
            
            <div class="status-card" id="statusCard">
                <div class="status-header">
                    <div class="spinner" id="spinner"></div>
                    <div class="status-text" id="statusText">æ¤œç´¢ã‚’æº–å‚™ä¸­...</div>
                </div>
                <div id="alertContainer"></div>
            </div>
            
            <div id="resultsContainer"></div>
        </div>
    </div>
    
    <script>
        let currentSearchId = null;
        let pollInterval = null;
        
        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const statusCard = document.getElementById('statusCard');
            const spinner = document.getElementById('spinner');
            const statusText = document.getElementById('statusText');
            const resultsContainer = document.getElementById('resultsContainer');
            
            // UIã‚’ãƒªã‚»ãƒƒãƒˆ
            submitBtn.disabled = true;
            submitBtn.textContent = 'æ¤œç´¢ä¸­...';
            statusCard.classList.add('show');
            spinner.style.display = 'block';
            statusText.textContent = 'æ¤œç´¢ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...';
            resultsContainer.innerHTML = '';
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const industry = document.getElementById('industry').value;
            const revenue = document.getElementById('revenue').value;
            const keywords = document.getElementById('keywords').value;
            
            // æ¥­ç•Œã¨å£²ä¸Šè¦æ¨¡ã®ãƒ©ãƒ™ãƒ«ã‚’å–å¾—
            const industryLabel = document.querySelector(`#industry option[value="${industry}"]`).textContent;
            const revenueLabel = document.querySelector(`#revenue option[value="${revenue}"]`).textContent;
            
            const formData = {
                industry: industry,
                revenue: revenue,
                keywords: keywords,
                num_companies: parseInt(document.getElementById('numCompanies').value),
                max_keymen: parseInt(document.getElementById('maxKeymen').value)
            };
            
            try {
                // æ¤œç´¢ã‚’é–‹å§‹
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                currentSearchId = data.search_id;
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°
                pollInterval = setInterval(checkStatus, 2000);
                
            } catch (error) {
                showAlert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message, 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'ğŸ” æ¤œç´¢ã‚’é–‹å§‹';
                spinner.style.display = 'none';
            }
        });
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯
        async function checkStatus() {
            try {
                const response = await fetch(`/api/search/${currentSearchId}`);
                const data = await response.json();
                
                const statusText = document.getElementById('statusText');
                const spinner = document.getElementById('spinner');
                const submitBtn = document.getElementById('submitBtn');
                
                if (data.status === 'processing') {
                    statusText.textContent = 'ä¼æ¥­æƒ…å ±ã¨å½¹å“¡ãƒ»è²¬ä»»è€…ã‚’æ¤œç´¢ä¸­...';
                }
                else if (data.status === 'completed') {
                    clearInterval(pollInterval);
                    spinner.style.display = 'none';
                    statusText.textContent = 'âœ… æ¤œç´¢ãŒå®Œäº†ã—ã¾ã—ãŸï¼';
                    showAlert(`${data.results.length} ä»¶ã®å½¹å“¡ãƒ»è²¬ä»»è€…æƒ…å ±ã‚’å–å¾—ã—ã¾ã—ãŸ`, 'success');
                    displayResults(data.results);
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ğŸ” æ¤œç´¢ã‚’é–‹å§‹';
                }
                else if (data.status === 'failed') {
                    clearInterval(pollInterval);
                    spinner.style.display = 'none';
                    statusText.textContent = 'âŒ æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ';
                    showAlert('ã‚¨ãƒ©ãƒ¼: ' + data.error_message, 'error');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ğŸ” æ¤œç´¢ã‚’é–‹å§‹';
                }
            } catch (error) {
                clearInterval(pollInterval);
                showAlert('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // çµæœã‚’è¡¨ç¤º
        function displayResults(results) {
            const container = document.getElementById('resultsContainer');
            
            if (!results || results.length === 0) {
                container.innerHTML = '<p>çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                return;
            }
            
            // ä¼æ¥­ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const companiesMap = {};
            results.forEach(result => {
                const companyName = result['ä¼æ¥­å'];
                if (!companiesMap[companyName]) {
                    companiesMap[companyName] = {
                        info: result,
                        keymen: []
                    };
                }
                companiesMap[companyName].keymen.push(result);
            });
            
            // HTMLç”Ÿæˆ
            let html = '<h2 style="margin-top: 30px; margin-bottom: 20px;">æ¤œç´¢çµæœ</h2>';
            
            // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³
            html += `
                <div class="export-buttons">
                    <button class="export-btn" onclick="exportResults('csv')">ğŸ“Š CSVã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="export-btn" onclick="exportResults('tsv')">ğŸ“‹ TSVã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="export-btn" onclick="exportResults('json')">ğŸ’¾ JSONã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="export-btn" onclick="copyToClipboard()">ğŸ“‹ TSVã‚’ã‚³ãƒ”ãƒ¼</button>
                </div>
            `;
            
            // ä¼æ¥­ã”ã¨ã«è¡¨ç¤º
            Object.values(companiesMap).forEach((company, index) => {
                const info = company.info;
                
                html += `
                    <div class="company-info">
                        <div class="company-name">${index + 1}. ${info['ä¼æ¥­å']}</div>
                        
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">ğŸŒ URL</span>
                                <span class="info-value"><a href="${info['ä¼æ¥­URL']}" target="_blank">${info['ä¼æ¥­URL']}</a></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ğŸ“… è¨­ç«‹å¹´</span>
                                <span class="info-value">${info['è¨­ç«‹å¹´'] || '-'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ğŸ’° å£²ä¸Š</span>
                                <span class="info-value">${info['å£²ä¸Š'] || '-'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ğŸ“Š åˆ©ç›Š</span>
                                <span class="info-value">${info['åˆ©ç›Š'] || '-'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ğŸ‘¥ å¾“æ¥­å“¡</span>
                                <span class="info-value">${info['å¾“æ¥­å“¡è¦æ¨¡'] || '-'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ğŸ¢ äº‹æ¥­é ˜åŸŸ</span>
                                <span class="info-value">${info['äº‹æ¥­é ˜åŸŸ'] || '-'}</span>
                            </div>
                        </div>
                        
                        <div class="info-item" style="margin-top: 10px;">
                            <span class="info-label">ğŸ¯ æ³¨åŠ›ãƒã‚¤ãƒ³ãƒˆ</span>
                            <span class="info-value">${info['æ³¨åŠ›ãƒã‚¤ãƒ³ãƒˆ'] || '-'}</span>
                        </div>
                        
                        <div class="info-item" style="margin-top: 10px;">
                            <span class="info-label">ğŸ“ äº‹æ¥­æ¦‚è¦</span>
                            <span class="info-value">${info['äº‹æ¥­æ¦‚è¦']}</span>
                        </div>
                        
                        <h4 style="margin-top: 20px; margin-bottom: 10px;">å½¹å“¡ãƒ»è²¬ä»»è€…ä¸€è¦§</h4>
                `;
                
                company.keymen.forEach(keyman => {
                    html += `
                        <div class="keyman-card">
                            <div class="keyman-header">
                                <div class="keyman-name">${keyman['ã‚­ãƒ¼ãƒãƒ³æ°å']}</div>
                                <div class="keyman-position">${keyman['å½¹è·å']}</div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            });
            
            container.innerHTML = html;
        }
        
        // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        async function exportResults(format) {
            if (!currentSearchId) return;
            
            window.location.href = `/api/export/${currentSearchId}/${format}`;
        }
        
        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        async function copyToClipboard() {
            if (!currentSearchId) return;
            
            try {
                const response = await fetch(`/api/export/${currentSearchId}/tsv`);
                const text = await response.text();
                
                await navigator.clipboard.writeText(text);
                showAlert('TSVå½¢å¼ã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼Excelã«è²¼ã‚Šä»˜ã‘ã§ãã¾ã™ã€‚', 'success');
            } catch (error) {
                showAlert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
            }
        }
        
        // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alertClass = type === 'error' ? 'alert-error' : 'alert-success';
            container.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }
    </script>
</body>
</html>

