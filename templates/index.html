<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIÂñ∂Ê•≠„Ç¢„Éù„Ç§„É≥„ÉàËá™ÂãïÂåñBOT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }
        
        .search-form {
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 1.1em;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
            background-color: white;
        }
        
        .form-group select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 45px;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group select:hover {
            border-color: #764ba2;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .status-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            display: none;
        }
        
        .status-card.show {
            display: block;
        }
        
        .status-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-text {
            font-size: 1.1em;
            color: #333;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            display: none;
        }
        
        .results-table.show {
            display: table;
        }
        
        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .results-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .results-table tr:hover {
            background: #f8f9fa;
        }
        
        .company-info {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        .company-name {
            font-size: 1.3em;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
        }
        
        .info-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 3px;
        }
        
        .info-value {
            font-weight: 500;
            color: #333;
        }
        
        .keyman-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .keyman-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .keyman-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }
        
        .keyman-position {
            color: #666;
            font-size: 0.95em;
        }
        
        .sns-links {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .sns-link {
            color: #667eea;
            text-decoration: none;
            font-size: 0.9em;
            padding: 5px 15px;
            border: 1px solid #667eea;
            border-radius: 20px;
            transition: all 0.3s;
        }
        
        .sns-link:hover {
            background: #667eea;
            color: white;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .export-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .export-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .main-card {
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AIÂñ∂Ê•≠„Ç¢„Éù„Ç§„É≥„ÉàËá™ÂãïÂåñBOT</h1>
            <p>‰ºÅÊ•≠„É™„Çπ„Éà„Ç¢„ÉÉ„Éó„ÉªÂΩπÂì°/Ë≤¨‰ªªËÄÖÁâπÂÆö„ÇíËá™ÂãïÂåñ</p>
        </div>
        
        <div class="main-card">
            <div class="search-form">
                <h2 style="margin-bottom: 20px; color: #333;">Ê§úÁ¥¢Êù°‰ª∂„ÇíÂÖ•Âäõ</h2>
                
                <form id="searchForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="industry">üè¢ Ê•≠Áïå *</label>
                            <select id="industry" name="industry" required>
                                <option value="">Ê•≠Áïå„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                <option value="beauty">ÁæéÂÆπ„ÉªÂåñÁ≤ßÂìÅ</option>
                                <option value="it_saas">IT„ÉªSaaS</option>
                                <option value="realestate">‰∏çÂãïÁî£</option>
                                <option value="fintech">ÈáëËûç„Éª„Éï„Ç£„É≥„ÉÜ„ÉÉ„ÇØ</option>
                                <option value="healthcare">„Éò„É´„Çπ„Ç±„Ç¢„ÉªÂåªÁôÇ</option>
                                <option value="retail">Â∞èÂ£≤„ÉªE„Ç≥„Éû„Éº„Çπ</option>
                                <option value="manufacturing">Ë£ΩÈÄ†Ê•≠</option>
                                <option value="food">È£≤È£ü„ÉªÈ£üÂìÅ</option>
                                <option value="education">ÊïôËÇ≤„ÉªEdTech</option>
                                <option value="logistics">Áâ©ÊµÅ</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="revenue">üí∞ Â£≤‰∏äË¶èÊ®° *</label>
                            <select id="revenue" name="revenue" required>
                                <option value="">Â£≤‰∏äË¶èÊ®°„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                <option value="under10">10ÂÑÑÂÜÜÊú™Ê∫Ä</option>
                                <option value="10to30">10ÂÑÑÂÜÜ‰ª•‰∏ä30ÂÑÑÂÜÜÊú™Ê∫Ä</option>
                                <option value="30to50">30ÂÑÑÂÜÜ‰ª•‰∏ä50ÂÑÑÂÜÜÊú™Ê∫Ä</option>
                                <option value="50to100">50ÂÑÑÂÜÜ‰ª•‰∏ä100ÂÑÑÂÜÜÊú™Ê∫Ä</option>
                                <option value="over100">100ÂÑÑÂÜÜ‰ª•‰∏ä</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="keywords">üîç ËøΩÂä†„Ç≠„Éº„ÉØ„Éº„ÉâÔºà‰ªªÊÑèÔºâ</label>
                        <input 
                            type="text" 
                            id="keywords" 
                            name="keywords" 
                            placeholder="‰æã: D2C„ÄÅ„Çπ„Çø„Éº„Éà„Ç¢„ÉÉ„Éó„ÄÅÊù±‰∫¨„ÄÅ„Ç∑„É™„Éº„Ç∫A"
                        >
                        <small style="color: #666; font-size: 0.9em; margin-top: 5px; display: block;">
                            „Çà„ÇäË©≥Á¥∞„Å™Êù°‰ª∂„ÇíÊåáÂÆö„Åó„Åü„ÅÑÂ†¥Âêà„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                        </small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="numCompanies">üìä ‰ºÅÊ•≠Êï∞</label>
                            <input 
                                type="number" 
                                id="numCompanies" 
                                name="numCompanies" 
                                value="5" 
                                min="1" 
                                max="100"
                            >
                            <small style="color: #666; font-size: 0.9em; margin-top: 5px; display: block;">
                                ÊúÄÂ§ß100Á§æ„Åæ„ÅßÂèñÂæóÂèØËÉΩ„Åß„Åô
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="maxKeymen">üë• ÂΩπÂì°„ÉªË≤¨‰ªªËÄÖÊï∞/‰ºÅÊ•≠</label>
                            <input 
                                type="number" 
                                id="maxKeymen" 
                                name="maxKeymen" 
                                value="5" 
                                min="1" 
                                max="10"
                            >
                        </div>
                    </div>
                    
                    <button type="submit" class="btn" id="submitBtn">
                        üîç Ê§úÁ¥¢„ÇíÈñãÂßã
                    </button>
                </form>
            </div>
            
            <div class="status-card" id="statusCard">
                <div class="status-header">
                    <div class="spinner" id="spinner"></div>
                    <div class="status-text" id="statusText">Ê§úÁ¥¢„ÇíÊ∫ñÂÇô‰∏≠...</div>
                </div>
                <div id="alertContainer"></div>
            </div>
            
            <div id="resultsContainer"></div>
        </div>
    </div>
    
    <script>
        let currentSearchId = null;
        let pollInterval = null;
        
        // „Éï„Ç©„Éº„É†ÈÄÅ‰ø°
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const statusCard = document.getElementById('statusCard');
            const spinner = document.getElementById('spinner');
            const statusText = document.getElementById('statusText');
            const resultsContainer = document.getElementById('resultsContainer');
            
            // UI„Çí„É™„Çª„ÉÉ„Éà
            submitBtn.disabled = true;
            submitBtn.textContent = 'Ê§úÁ¥¢‰∏≠...';
            statusCard.classList.add('show');
            spinner.style.display = 'block';
            statusText.textContent = 'Ê§úÁ¥¢„ÇíÈñãÂßã„Åó„Å¶„ÅÑ„Åæ„Åô...';
            resultsContainer.innerHTML = '';
            
            // „Éï„Ç©„Éº„É†„Éá„Éº„Çø„ÇíÂèñÂæó
            const industry = document.getElementById('industry').value;
            const revenue = document.getElementById('revenue').value;
            const keywords = document.getElementById('keywords').value;
            
            // Ê•≠Áïå„Å®Â£≤‰∏äË¶èÊ®°„ÅÆ„É©„Éô„É´„ÇíÂèñÂæó
            const industryLabel = document.querySelector(`#industry option[value="${industry}"]`).textContent;
            const revenueLabel = document.querySelector(`#revenue option[value="${revenue}"]`).textContent;
            
            const formData = {
                industry: industry,
                revenue: revenue,
                keywords: keywords,
                num_companies: parseInt(document.getElementById('numCompanies').value),
                max_keymen: parseInt(document.getElementById('maxKeymen').value)
            };
            
            try {
                // Ê§úÁ¥¢„ÇíÈñãÂßã
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                currentSearchId = data.search_id;
                
                // „Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Éù„Éº„É™„É≥„Ç∞
                pollInterval = setInterval(checkStatus, 2000);
                
            } catch (error) {
                showAlert('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'üîç Ê§úÁ¥¢„ÇíÈñãÂßã';
                spinner.style.display = 'none';
            }
        });
        
        // „Çπ„ÉÜ„Éº„Çø„Çπ„ÉÅ„Çß„ÉÉ„ÇØ
        async function checkStatus() {
            try {
                const response = await fetch(`/api/search/${currentSearchId}`);
                const data = await response.json();
                
                const statusText = document.getElementById('statusText');
                const spinner = document.getElementById('spinner');
                const submitBtn = document.getElementById('submitBtn');
                
                if (data.status === 'processing') {
                    statusText.textContent = '‰ºÅÊ•≠ÊÉÖÂ†±„Å®ÂΩπÂì°„ÉªË≤¨‰ªªËÄÖ„ÇíÊ§úÁ¥¢‰∏≠...';
                }
                else if (data.status === 'completed') {
                    clearInterval(pollInterval);
                    spinner.style.display = 'none';
                    statusText.textContent = '‚úÖ Ê§úÁ¥¢„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ';
                    showAlert(`${data.results.length} ‰ª∂„ÅÆÂΩπÂì°„ÉªË≤¨‰ªªËÄÖÊÉÖÂ†±„ÇíÂèñÂæó„Åó„Åæ„Åó„Åü`, 'success');
                    displayResults(data.results);
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'üîç Ê§úÁ¥¢„ÇíÈñãÂßã';
                }
                else if (data.status === 'failed') {
                    clearInterval(pollInterval);
                    spinner.style.display = 'none';
                    statusText.textContent = '‚ùå Ê§úÁ¥¢„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';
                    showAlert('„Ç®„É©„Éº: ' + data.error_message, 'error');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'üîç Ê§úÁ¥¢„ÇíÈñãÂßã';
                }
            } catch (error) {
                clearInterval(pollInterval);
                showAlert('„Çπ„ÉÜ„Éº„Çø„ÇπÁ¢∫Ë™ç‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
            }
        }
        
        // ÁµêÊûú„ÇíË°®Á§∫
        function displayResults(results) {
            const container = document.getElementById('resultsContainer');
            
            if (!results || results.length === 0) {
                container.innerHTML = '<p>ÁµêÊûú„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
                return;
            }
            
            // ‰ºÅÊ•≠„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
            const companiesMap = {};
            results.forEach(result => {
                const companyName = result['‰ºÅÊ•≠Âêç'];
                if (!companiesMap[companyName]) {
                    companiesMap[companyName] = {
                        info: result,
                        keymen: []
                    };
                }
                companiesMap[companyName].keymen.push(result);
            });
            
            // HTMLÁîüÊàê
            let html = '<h2 style="margin-top: 30px; margin-bottom: 20px;">Ê§úÁ¥¢ÁµêÊûú</h2>';
            
            // „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Éú„Çø„É≥
            html += `
                <div class="export-buttons">
                    <button class="export-btn" onclick="exportResults('csv')">üìä CSV„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                    <button class="export-btn" onclick="exportResults('tsv')">üìã TSV„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                    <button class="export-btn" onclick="exportResults('json')">üíæ JSON„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                    <button class="export-btn" onclick="copyToClipboard()">üìã TSV„Çí„Ç≥„Éî„Éº</button>
                </div>
            `;
            
            // ‰ºÅÊ•≠„Åî„Å®„Å´Ë°®Á§∫
            Object.values(companiesMap).forEach((company, index) => {
                const info = company.info;
                
                html += `
                    <div class="company-info">
                        <div class="company-name">${index + 1}. ${info['‰ºÅÊ•≠Âêç']}</div>
                        
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">üåê URL</span>
                                <span class="info-value"><a href="${info['‰ºÅÊ•≠URL']}" target="_blank">${info['‰ºÅÊ•≠URL']}</a></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">üìÖ Ë®≠Á´ãÂπ¥</span>
                                <span class="info-value">${info['Ë®≠Á´ãÂπ¥'] || '-'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">üí∞ Â£≤‰∏ä</span>
                                <span class="info-value">${info['Â£≤‰∏ä'] || '-'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">üìä Âà©Áõä</span>
                                <span class="info-value">${info['Âà©Áõä'] || '-'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">üë• ÂæìÊ•≠Âì°</span>
                                <span class="info-value">${info['ÂæìÊ•≠Âì°Ë¶èÊ®°'] || '-'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">üè¢ ‰∫ãÊ•≠È†òÂüü</span>
                                <span class="info-value">${info['‰∫ãÊ•≠È†òÂüü'] || '-'}</span>
                            </div>
                        </div>
                        
                        <div class="info-item" style="margin-top: 10px;">
                            <span class="info-label">üéØ Ê≥®Âäõ„Éù„Ç§„É≥„Éà</span>
                            <span class="info-value">${info['Ê≥®Âäõ„Éù„Ç§„É≥„Éà'] || '-'}</span>
                        </div>
                        
                        <div class="info-item" style="margin-top: 10px;">
                            <span class="info-label">üìù ‰∫ãÊ•≠Ê¶ÇË¶Å</span>
                            <span class="info-value">${info['‰∫ãÊ•≠Ê¶ÇË¶Å']}</span>
                        </div>
                        
                        <h4 style="margin-top: 20px; margin-bottom: 10px;">ÂΩπÂì°„ÉªË≤¨‰ªªËÄÖ‰∏ÄË¶ß</h4>
                `;
                
                company.keymen.forEach(keyman => {
                    html += `
                        <div class="keyman-card">
                            <div class="keyman-header">
                                <div class="keyman-name">${keyman['„Ç≠„Éº„Éû„É≥Ê∞èÂêç']}</div>
                                <div class="keyman-position">${keyman['ÂΩπËÅ∑Âêç']}</div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            });
            
            container.innerHTML = html;
        }
        
        // „Ç®„ÇØ„Çπ„Éù„Éº„Éà
        async function exportResults(format) {
            if (!currentSearchId) return;
            
            window.location.href = `/api/export/${currentSearchId}/${format}`;
        }
        
        // „ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº
        async function copyToClipboard() {
            if (!currentSearchId) return;
            
            try {
                const response = await fetch(`/api/export/${currentSearchId}/tsv`);
                const text = await response.text();
                
                await navigator.clipboard.writeText(text);
                showAlert('TSVÂΩ¢Âºè„Åß„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅExcel„Å´Ë≤º„Çä‰ªò„Åë„Åß„Åç„Åæ„Åô„ÄÇ', 'success');
            } catch (error) {
                showAlert('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            }
        }
        
        // „Ç¢„É©„Éº„ÉàË°®Á§∫
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alertClass = type === 'error' ? 'alert-error' : 'alert-success';
            container.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }
    </script>
</body>
</html>

